# Код для подготовки данных к разметке с использованием CVAT


## Описание модулей

### pcd_utils/mcap_to_pcd.py
Этот модуль конвертирует файлы формата `mcap` (используемого в ROS2) в облака точек формата `pcd`. Он разбивает облако точек по кадрам с заданной частотой.

### cvat_api/get_annotations.py
Позволяет загрузить разметку из CVAT по заданному `job_id`. Упрощает интеграцию с CVAT API для быстрого получения аннотаций.

### s3_storage/zip_on_s3.py
Этот скрипт загружает на S3 исходные файлы для разметки в CVAT, а также позволяет скачивать их обратно при необходимости.

### frames_from_mp4.py
Разрезает видеофайлы на кадры и организует их в соответствующие папки, чтобы подготовить к разметке в CVAT.

### pipeline.py
Полностью автоматизированный пайплайн для подготовки данных:
1. Берет видеофайлы из папки `input_mp4`, нарезает их на кадры.
2. Берет `mcap` файлы и метаданные из папки `input_mcap`, конвертирует облака точек и разбивает их по кадрам.
3. Собирает все кадры в ZIP-архив и сохраняет в папку `output_zip`.
4. Архив можно загрузить на S3 с помощью соответствующих скриптов, чтобы использовать для разметки.

### config.py и privat_config.py
Эти файлы задают параметры конфигурации. `privat_config.py` получает чувствительные данные из переменных окружения или из файла `.env`.

- `AWS_ACCESS_KEY_ID` — ID ключа доступа к Amazon S3.
- `AWS_SECRET_ACCESS_KEY` — секретный ключ для работы с S3.
- `CVAT_LOGIN` — логин для авторизации в CVAT.
- `CVAT_PASSWORD` — пароль для CVAT.
- `CVAT_HOST` — URL хоста, где развернут CVAT.

# Параметры в `config.py`
- `run_name` — название записи
- `frequency` — частота извлечения кадров из видео и конвертации в облако точек
- `elapsed_time` — сдвиг mcap записи в секундах (нужен для совмещения по времени pcd и mp4)

## Быстрый старт

1. Установите зависимости:
```
pip install -r requirements.txt
```
2. Заполните `.env` файл своими параметрами и config.py
3. Загрузите видеофайлы в папку `input_mp4` (должно быть 4 видео с названиями {run_name}-0, 90, 180 и 270, соответственно)
4. Загрузите `mcap` файлы в папку `input_mcap` (название должно быть {run_name}.mcap, метаданные — {run_name}_metadata.yaml)5
5. Запустите пайплайн:
```
python pipeline.py
```
